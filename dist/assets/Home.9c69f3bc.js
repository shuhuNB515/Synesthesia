import{o as e,c as a,b as s,u as t,r as l,a as o,t as i,w as n,v as r,x as c,y as u,n as d,z as v,A as p}from"./vendor.180ccd0d.js";import{_ as h}from"./index.19e6512d.js";class g{constructor(){this.context=null,this.analyser=null,this.dataArray=null,this.source=null,this.audioBuffer=null,this.isPlaying=!1,this.startTime=0,this.pauseOffset=0}initContext(){this.context||(this.context=new(window.AudioContext||window.webkitAudioContext),this.analyser=this.context.createAnalyser(),this.analyser.fftSize=512,this.dataArray=new Uint8Array(this.analyser.frequencyBinCount),this.dest=this.context.createMediaStreamDestination(),this.analyser.connect(this.dest))}getAudioStream(){return this.dest?this.dest.stream:null}async useMicrophone(){this.stop(),this.initContext();try{const e=await navigator.mediaDevices.getUserMedia({audio:!0});this.source=this.context.createMediaStreamSource(e),this.source.connect(this.analyser),this.isPlaying=!0,console.log("å·²åˆ‡æ¢è‡³éº¦å…‹é£æ¨¡å¼")}catch(e){console.error("éº¦å…‹é£è·å–å¤±è´¥",e)}}async loadFile(e){this.initContext(),this.audioBuffer=await this.context.decodeAudioData(e),console.log("éŸ³é¢‘æ–‡ä»¶è§£ç å®Œæˆ")}playFile(){this.audioBuffer&&(this.stop(),this.initContext(),this.source=this.context.createBufferSource(),this.source.buffer=this.audioBuffer,this.source.connect(this.analyser),this.analyser.connect(this.context.destination),this.source.start(0,this.pauseOffset),this.startTime=this.context.currentTime,this.isPlaying=!0,this.source.onended=()=>{})}pauseFile(){this.source&&this.isPlaying&&(this.source.stop(),this.pauseOffset+=this.context.currentTime-this.startTime,this.isPlaying=!1)}stop(){if(this.source)try{this.source.disconnect(),this.source.stop&&this.source.stop()}catch(e){}this.isPlaying=!1}getFrequencyData(){if(!this.analyser)return{bass:0,mid:0,high:0};this.analyser.getByteFrequencyData(this.dataArray);return{bass:this.average(this.dataArray.slice(0,10)),mid:this.average(this.dataArray.slice(10,100)),high:this.average(this.dataArray.slice(100,200))}}average(e){return e.reduce(((e,a)=>e+a),0)/e.length}}const y={class:"navbar-fixed"},f={class:"user-area"},m={key:0,class:"user-controls"},b={__name:"NavBar",props:["isLoggedIn"],emits:["open-auth","logout"],setup:l=>(o,i)=>(e(),a("div",y,[s("div",{class:"brand-logo",onClick:i[0]||(i[0]=e=>o.$router.push("/"))},"SYN.ART"),s("div",f,[l.isLoggedIn?(e(),a("div",m,[s("div",{class:"user-entry",onClick:i[1]||(i[1]=e=>o.$router.push("/user"))},[...i[4]||(i[4]=[s("div",{class:"avatar-glow"},"U",-1),s("span",{class:"entry-text"},"ä¸ªäººä¸­å¿ƒ",-1)])]),s("button",{class:"btn-logout-mini",onClick:i[2]||(i[2]=e=>o.$emit("logout"))},"é€€å‡º")])):(e(),a("button",{key:1,class:"btn-login-glass",onClick:i[3]||(i[3]=e=>o.$emit("open-auth"))},[...i[5]||(i[5]=[s("span",{class:"icon"},"âœ¨",-1),t(" ç™»å½• / æ³¨å†Œ ",-1)])]))])])),__scopeId:"data-v-25d7bd6c"};const w={class:"cyber-card"},k={class:"title"},A={class:"form-group"},C={class:"input-wrapper"},I={class:"error-msg"},S={key:0},x={class:"input-wrapper code-row"},P=["disabled"],R={class:"input-wrapper"},_={class:"error-msg"},L={key:1},O={class:"input-wrapper"},T={class:"error-msg"},D={class:"footer-links"},F={key:0,class:"between"},E={key:1,class:"center"},U={__name:"AuthModal",props:["isVisible"],emits:["close","login-success"],setup(t,{emit:d}){const v=d,p=[{account:"13800138000",password:"Password@123"},{account:"test@art.com",password:"Password@456"}],h=l("login"),g=l(0),y=o({account:"",password:"",confirmPwd:"",code:""}),f=o({account:"",password:"",confirm:""}),m=()=>{h.value="login",v("close")},b=()=>{if(!y.account)return;const e=p.some((e=>e.account===y.account));"login"!==h.value||e?"register"===h.value&&e?f.account="è¯¥è´¦å·å·²å­˜åœ¨ï¼Œè¯·ç›´æ¥ç™»å½•":f.account="":f.account="è¯¥è´¦å·å°šæœªæ³¨å†Œ"},U=()=>{if(!y.account)return void alert("è¯·å…ˆè¾“å…¥è´¦å·");alert("éªŒè¯ç å·²å‘é€è‡³: "+y.account),g.value=60;const e=setInterval((()=>{g.value--,g.value<=0&&clearInterval(e)}),1e3)},M=()=>{if(/^(?=.*[a-z])(?=.*[A-Z])(?=.*[!@#$%^&*])[a-zA-Z\d!@#$%^&*]{8,}$/.test(y.password)){if(f.password="","login"===h.value){const e=p.find((e=>e.account===y.account));e?e.password!==y.password?f.password="å¯†ç é”™è¯¯ï¼Œè¯·é‡è¯•":(alert("ç™»å½•æˆåŠŸï¼Œæ¬¢è¿å›æ¥"),v("login-success"),m()):f.account="è´¦å·ä¸å­˜åœ¨"}else if("forgot"===h.value){if(y.password!==y.confirmPwd)return void(f.confirm="ä¸¤æ¬¡å¯†ç ä¸ä¸€è‡´");if(!y.code)return void alert("è¯·è¾“å…¥éªŒè¯ç ");const e=p.findIndex((e=>e.account===y.account));-1!==e?(p[e].password=y.password,alert("å¯†ç å·²é‡ç½®ï¼Œè¯·ä½¿ç”¨æ–°å¯†ç ç™»å½•"),h.value="login"):alert("è´¦å·ä¸å­˜åœ¨ï¼Œé‡ç½®å¤±è´¥")}else if("register"===h.value){if(p.some((e=>e.account===y.account)))return void alert("è´¦å·å·²å­˜åœ¨");p.push({account:y.account,password:y.password}),alert("æ³¨å†ŒæˆåŠŸï¼"),h.value="login"}}else f.password="éœ€8ä½ä»¥ä¸Šï¼Œå«å¤§å°å†™å’Œç‰¹æ®Šç¬¦å·"};return(l,o)=>t.isVisible?(e(),a("div",{key:0,class:"modal-backdrop",onClick:u(m,["self"])},[s("div",w,[o[10]||(o[10]=s("div",{class:"neon-line"},null,-1)),s("h2",k,i("login"===h.value?"IDENTITY LOGIN":"register"===h.value?"CREATE ACCESS":"RESET PASSWORD"),1),s("div",A,[o[9]||(o[9]=s("label",null,"ACCOUNT",-1)),s("div",C,[n(s("input",{type:"text","onUpdate:modelValue":o[0]||(o[0]=e=>y.account=e),placeholder:"æ‰‹æœºå· / é‚®ç®±",onBlur:b},null,544),[[r,y.account]])]),s("p",I,i(f.account),1),"forgot"===h.value||"register"===h.value?(e(),a("div",S,[o[7]||(o[7]=s("label",null,"VERIFICATION CODE",-1)),s("div",x,[n(s("input",{type:"text","onUpdate:modelValue":o[1]||(o[1]=e=>y.code=e),placeholder:"6ä½éªŒè¯ç "},null,512),[[r,y.code]]),s("button",{class:"btn-send-code",onClick:U,disabled:g.value>0},i(g.value>0?`${g.value}s`:"è·å–"),9,P)])])):c("",!0),s("label",null,i("login"===h.value?"PASSWORD":"NEW PASSWORD"),1),s("div",R,[n(s("input",{type:"password","onUpdate:modelValue":o[2]||(o[2]=e=>y.password=e),placeholder:"è¯·è¾“å…¥å¯†ç "},null,512),[[r,y.password]])]),s("p",_,i(f.password),1),"login"!==h.value?(e(),a("div",L,[o[8]||(o[8]=s("label",null,"CONFIRM PASSWORD",-1)),s("div",O,[n(s("input",{type:"password","onUpdate:modelValue":o[3]||(o[3]=e=>y.confirmPwd=e),placeholder:"å†æ¬¡è¾“å…¥å¯†ç "},null,512),[[r,y.confirmPwd]])]),s("p",T,i(f.confirm),1)])):c("",!0)]),s("button",{class:"btn-main",onClick:M},i("login"===h.value?"ç«‹å³ç™»å½•":"register"===h.value?"æäº¤æ³¨å†Œ":"ç¡®è®¤é‡ç½®"),1),s("div",D,["login"===h.value?(e(),a("div",F,[s("a",{onClick:o[4]||(o[4]=e=>h.value="forgot")},"å¿˜è®°å¯†ç ?"),s("a",{onClick:o[5]||(o[5]=e=>h.value="register")},"å»æ³¨å†Œ")])):(e(),a("div",E,[s("a",{onClick:o[6]||(o[6]=e=>h.value="login")},"è¿”å›ç™»å½•")]))])])])):c("",!0)},__scopeId:"data-v-f1109956"};const M={class:"music-player-card"},V={key:1,class:"upload-zone"},B={key:2,class:"player-zone"},N={class:"track-info"},$={class:"track-name"},q={class:"track-status"},z={key:0,class:"recording-dot"},W={key:1},Y={class:"controls"},j=["disabled"],G=["disabled"],H={key:3,class:"video-preview-modal"},Z=["src"],J={class:"download-actions"},K=["href"],Q=["href"],X={__name:"MusicPlayer",props:["isLoggedIn"],emits:["file-loaded","require-login","play","pause","reset","start-record","stop-record"],setup(t,{expose:o,emit:n}){const r=n,u=l(!1),v=l(""),p=l(!1),h=l(!1),g=l(null),y=e=>{const a=e.target.files[0];if(!a)return;v.value=a.name,u.value=!0;const s=new FileReader;s.onload=e=>r("file-loaded",e.target.result),s.readAsArrayBuffer(a)},f=()=>{p.value=!p.value,p.value?r("play"):r("pause")},m=()=>{h.value?(h.value=!1,r("stop-record")):(h.value=!0,p.value||f(),r("start-record"))},b=()=>{URL.revokeObjectURL(g.value),g.value=null},w=()=>{u.value=!1,p.value=!1,g.value=null,r("reset")};return o({setRecordedVideo:e=>{g.value=e,p.value=!1,h.value=!1}}),(l,o)=>(e(),a("div",M,[t.isLoggedIn?u.value?(e(),a("div",B,[s("div",{class:d(["disc-wrapper",{spinning:p.value}])},[...o[3]||(o[3]=[s("div",{class:"disc-art"},null,-1)])],2),s("div",N,[s("div",$,i(v.value),1),s("div",q,[h.value?(e(),a("span",z,"ğŸ”´ REC")):(e(),a("span",W,i(p.value?"PLAYING":"READY"),1))])]),s("div",Y,[s("button",{class:"ctrl-btn",onClick:f,disabled:h.value},i(p.value?"â¸":"â–¶"),9,j),s("button",{class:d(["ctrl-btn record-btn",{active:h.value}]),onClick:m,title:"å½•åˆ¶è§†é¢‘"},i(h.value?"â¹":"ğŸ¥"),3),s("button",{class:"ctrl-btn small",onClick:w,disabled:h.value},"â",8,G)])])):(e(),a("div",V,[s("input",{type:"file",id:"music-upload",accept:"audio/*",onChange:y},null,32),o[2]||(o[2]=s("label",{for:"music-upload",class:"upload-btn"},[s("span",{class:"icon"},"ğŸµ"),s("span",{class:"text"},"UPLOAD AUDIO"),s("span",{class:"sub"},"æ”¯æŒ MP3 / WAV Â· ç”Ÿæˆä¸“å±è§†é¢‘")],-1))])):(e(),a("div",{key:0,class:"upload-zone locked",onClick:o[0]||(o[0]=e=>l.$emit("require-login"))},[...o[1]||(o[1]=[s("div",{class:"upload-btn"},[s("span",{class:"icon"},"ğŸ”’"),s("span",{class:"text"},"LOGIN TO UPLOAD"),s("span",{class:"sub"},"ç™»å½•åè§£é”éŸ³ä¹ä¸Šä¼ ä¸è§†é¢‘å¯¼å‡º")],-1)])])),g.value?(e(),a("div",H,[s("div",{class:"preview-header"},[o[4]||(o[4]=s("span",null,"PREVIEW",-1)),s("button",{class:"close-btn",onClick:b},"Ã—")]),s("video",{src:g.value,controls:"",autoplay:"",class:"preview-video"},null,8,Z),s("div",J,[s("a",{href:g.value,download:"synesthesia_art.webm",class:"dl-btn"},"ä¸‹è½½ WebM",8,K),s("a",{href:g.value,download:"synesthesia_art.mp4",class:"dl-btn outline"},"ä¸‹è½½ MP4 (å…¼å®¹)",8,Q)])])):c("",!0)]))},__scopeId:"data-v-ff782a4a"};const ee={class:"home-container"},ae={key:0,class:"hero-overlay"},se={__name:"Home",setup(t){const o=l(!1),i=l(!1),n=l(!1),r=l(!1),u=l(null),d=l(null),y=new g;let f=null,m=[];v((()=>{localStorage.getItem("user_token")&&(i.value=!0),u.value&&u.value.initThree()}));const w=()=>{if(!u.value||!y)return;const e=u.value.getCanvasStream(),a=y.getAudioStream();if(!e||!a)return void alert("æ— æ³•è·å–å½•åˆ¶æµï¼Œè¯·ç¡®ä¿å·²å¼€å¯éº¦å…‹é£æˆ–æ’­æ”¾éŸ³ä¹");const s=new MediaStream([...e.getVideoTracks(),...a.getAudioTracks()]),t={mimeType:"video/webm; codecs=vp9,opus"};try{f=new MediaRecorder(s,t)}catch(l){f=new MediaRecorder(s)}m=[],f.ondataavailable=e=>{e.data.size>0&&m.push(e.data)},f.onstop=()=>{const e=new Blob(m,{type:"video/webm"}),a=URL.createObjectURL(e);d.value&&d.value.setRecordedVideo(a),y.pauseFile()},f.start(),console.log("å½•åˆ¶å¼€å§‹...")},k=()=>{f&&"inactive"!==f.state&&(f.stop(),console.log("å½•åˆ¶ç»“æŸ"))},A=async()=>{try{await y.useMicrophone(),n.value=!0,r.value=!1,I()}catch(e){alert("éœ€è¦éº¦å…‹é£æƒé™")}},C=async e=>{y.stop(),r.value=!0,n.value=!0,await y.loadFile(e),y.playFile(),I()},I=()=>{const e=()=>{if(y.isPlaying){const e=y.getFrequencyData();u.value&&u.value.updateGeometry(e)}requestAnimationFrame(e)};e()},S=()=>y.playFile(),x=()=>y.pauseFile(),P=()=>{y.stop(),r.value=!1,n.value=!1},R=()=>{i.value=!0,o.value=!1,localStorage.setItem("user_token","ok")},_=()=>{i.value=!1,localStorage.removeItem("user_token")};return(t,l)=>(e(),a("div",ee,[p(b,{isLoggedIn:i.value,onOpenAuth:l[0]||(l[0]=e=>o.value=!0),onLogout:_},null,8,["isLoggedIn"]),p(h,{ref_key:"canvasRef",ref:u},null,512),p(X,{ref_key:"musicPlayerRef",ref:d,isLoggedIn:i.value,onRequireLogin:l[1]||(l[1]=e=>o.value=!0),onFileLoaded:C,onPlay:S,onPause:x,onReset:P,onStartRecord:w,onStopRecord:k},null,8,["isLoggedIn"]),p(U,{isVisible:o.value,onClose:l[2]||(l[2]=e=>o.value=!1),onLoginSuccess:R},null,8,["isVisible"]),n.value||r.value?c("",!0):(e(),a("div",ae,[l[4]||(l[4]=s("h1",{class:"title-main"},"SYNESTHESIA",-1)),l[5]||(l[5]=s("div",{class:"subtitle-group"},[s("p",{class:"cn-text"},"é€šæ„Ÿ Â· é¢‘ç‡ Â· è‰ºæœ¯")],-1)),s("button",{class:"btn-start",onClick:A},[...l[3]||(l[3]=[s("span",{class:"btn-content"},"å¼€å¯éº¦å…‹é£åˆ›ä½œ",-1)])])]))]))},__scopeId:"data-v-dbe10ff8"};export{se as default};
